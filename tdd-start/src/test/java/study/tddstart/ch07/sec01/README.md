## λ€μ—­μ ν•„μ”μ„±

μλ™μ΄μ²΄ κΈ°λ¥μ„ μλ΅ λ“¤μ–΄λ³΄μ. μ΄ κΈ°λ¥μ€ μ™Έλ¶€ μ—…μ²΄κ°€ μ κ³µν•λ” APIλ¥Ό μ΄μ©ν•΄μ„ μΉ΄λ“λ²νΈκ°€ μ ν¨ν•μ§€ ν™•μΈν•κ³  κ·Έ κ²°κ³Όμ— λ”°λΌ μλ™μ΄μ²΄ μ •λ³΄λ¥Ό λ“±λ΅ν•λ‹¤. μ΄ κΈ°λ¥μ„ ν…μ¤νΈν•λ ¤λ©΄ μ •μƒ μΉ΄λ“λ²νΈ, λ„λ‚ μΉ΄λ“λ²νΈ, λ§λ£μΌμ΄ μ§€λ‚ μΉ΄λ“λ²νΈκ°€ ν•„μ”ν•κΈ° λ•λ¬Έμ— μ™Έλ¶€ μ—…μ²΄μ—μ„ μƒν™©λ³„λ΅ ν…μ¤νΈν•  μ μλ” μΉ΄λ“λ²νΈλ¥Ό λ°›μ•„μ™€μ•Ό ν•λ‹¤.

TDDλ” β€ν…μ¤νΈ μ‘μ„± β†’ ν†µκ³Όμ‹ν‚¬ λ§νΌ κµ¬ν„ β†’ λ¦¬ν©ν„°λ§β€μ κ³Όμ •μΌλ΅ μ§„ν–‰ν•λ‹¤.

> μλ™μ΄μ²΄ μ •λ³΄ λ“±λ΅ κΈ°λ¥ β†’ μΉ΄λ“ λ²νΈ κ²€μ‚¬κΈ° β†’ μΉ΄λ“ μ •λ³΄ κ²€μ‚¬ λ€ν–‰ μ—…μ²΄(μ™Έλ¶€ μ‹μ¤ν…)μ μΉ΄λ“ μ •λ³΄ κ²€μ‚¬ API
>

μλ™μ΄μ²΄ μ •λ³΄ λ“±λ΅ κΈ°λ¥μ„ ν…μ¤νΈν•λ” μ½”λ“λ” μ™Έλ¶€ μ”μΈμΈ μΉ΄λ“ μ •λ³΄ κ²€μ‚¬ λ€ν–‰μ—…μ²΄μ μƒνƒμ— λ”°λΌ ν…μ¤νΈλ¥Ό ν•  μ μ—†λ” μƒν™©μ΄ λ°μƒν•λ‹¤.

μλ¥Ό λ“¤μ–΄ μΉ΄λ“ μ •λ³΄ κ²€μ‚¬ λ€ν–‰μ—…μ²΄μ—μ„ ν…μ¤νΈν•  λ• μ‚¬μ©ν•λΌκ³  μ κ³µν• μΉ΄λ“λ²νΈμ μ ν¨ κΈ°κ°„μ΄ ν• λ‹¬ λ’¤μΌ μ μλ‹¤. μ΄ μΉ΄λ“λ²νΈλ¥Ό μ‚¬μ©ν•΄μ„ μ„±κ³µν• μλ™μ΄μ²΄ μ •λ³΄ λ“±λ΅ κΈ°λ¥ ν…μ¤νΈλ” ν• λ‹¬ λ’¤μ— μ ν¨ κΈ°κ°„ λ§λ£λ΅ μ‹¤ν¨ν•κ² λλ‹¤.

μλ™μ΄μ²΄ μ •λ³΄ λ“±λ΅ κΈ°λ¥κ³Ό μΉ΄λ“λ²νΈ κ²€μ‚¬κΈ°μ μ½”λ“ κµ¬μ΅°κ°€ λ‹¤μκ³Ό κ°™λ‹¤.

> AutoDebitRegister β†’ CardNumberValidator β€” API νΈμ¶ β†’ μ™Έλ¶€ μΉ΄λ“ μ •λ³΄ API
>

`AutoDebitRegister` ν΄λμ¤λ” μλ™μ΄μ²΄ λ“±λ΅ κΈ°λ¥μ„ κµ¬ν„ν–κ³  `CardNumberValidator`λ” μ™Έλ¶€ APIλ¥Ό μ΄μ©ν•΄μ„ μΉ΄λ“λ²νΈκ°€ μ ν¨ν•μ§€ ν™•μΈν•λ‹¤. `AutoDebitRegister` ν΄λμ¤λ” `CardNumberValidator`λ¥Ό μ΄μ©ν•΄μ„ μΉ΄λ“λ²νΈκ°€ μ ν¨ν•μ§€ κ²€μ‚¬ν• λ’¤μ— κ·Έ κ²°κ³Όμ— λ”°λΌ μλ™μ΄μ²΄ μ •λ³΄λ¥Ό μ €μ¥ν•λ‹¤.

`AutoDebitRegister` ν΄λμ¤μ—μ„ μ‚¬μ©ν•λ” `CardNumberValidator` ν΄λμ¤λ” μ•„λμ™€ κ°™μ΄ μ™Έλ¶€ μ„λΉ„μ¤μ—μ„ μ κ³µν•λ” HTTP URLμ„ μ΄μ©ν•΄ μΉ΄λ“λ²νΈκ°€ μ ν¨ν•μ§€ κ²€μ‚¬ν•κ³  κ·Έ κ²°κ³Όλ¥Ό λ¦¬ν„΄ν•λ‹¤. μ°Έκ³ λ΅ μ΄ μ½”λ“λ” μλ¥Ό λ“¤κΈ° μ„ν• μ½”λ“λ΅ μ‹¤μ λ΅ some-external-pgμ™€ κ°™μ€ μ„λΉ„μ¤λ” μ΅΄μ¬ν•μ§€ μ•λ”λ‹¤.

`AutoDebitRegister` ν΄λμ¤λ¥Ό ν…μ¤νΈν•λ” μ½”λ“λ¥Ό μ‘μ„±ν•λ‹¤.

`validCard()` ν…μ¤νΈλ¥Ό ν†µκ³Όμ‹ν‚¤λ ¤λ©΄ μ™Έλ¶€ μ—…μ²΄μ—μ„ ν…μ¤νΈ λ©μ μ μ ν¨ν• μΉ΄λ“ λ²νΈλ¥Ό λ°›μ•„μ•Ό ν•λ‹¤. λ§μ•½ μ΄ μΉ΄λ“λ²νΈκ°€ ν• λ‹¬ λ’¤μ— λ§λ£λλ©΄ `validCard()` ν…μ¤νΈλ” ν• λ‹¬ λ’¤λ¶€ν„° μ‹¤ν¨ν•λ‹¤.

μ΄λ ‡κ² ν…μ¤νΈ λ€μƒμ—μ„ μμ΅΄ν•λ” μ”μΈ λ•λ¬Έμ— ν…μ¤νΈκ°€ μ–΄λ ¤μΈ λ•λ” λ€μ—­μ„ μ¨μ„ ν…μ¤νΈλ¥Ό μ§„ν–‰ν•  μ μλ‹¤. β†’ μ•΅μ…μ„ λ°°μ°κ°€ ν•λ”κ² μ•„λ‹λΌ μ¤ν„΄νΈλ§¨μ΄ ν•λ” κ²ƒκ³Ό κ°™λ‹¤.

>π’΅ Double : μμ–΄λ΅ λ ν…μ¤νΈ κ΄€λ ¨ κΈ€μ„ μ½μΌλ©΄ test doubleμ΄λ€ ν‘ν„μ΄ μμ£Ό λ‚μ¤λ”λ° μ—¬κΈ°μ„ doubleμ€ λ³Έ μ¥μ—μ„ μ„¤λ…ν•λ” λ€μ—­μ— ν•΄λ‹Ήν•λ‹¤. μ¦‰, test doubleμ€ ν…μ¤νΈμ—μ„ μ§„μ§ λ€μ‹  μ‚¬μ©ν•  λ€μ—­μ„ μλ―Έν•λ‹¤.
λ€μ—­μ μΆ…λ¥λ” μ¤ν…, κ°€μ§, μ¤νμ΄, λ¨μ κ°μ²΄κ°€ μ΅΄μ¬ν•λ©° κ° λ€μ—­ μΆ…λ¥λ§λ‹¤ μ“°μ„μƒκ°€ λ‹¤λ¥΄λ‹¤.

## λ€μ—­μ„ μ΄μ©ν• ν…μ¤νΈ

λ€μ—­μ„ μ΄μ©ν•΄ `AutoDebitRegister` λ¥Ό ν…μ¤νΈν•λ” μ½”λ“λ¥Ό λ‹¤μ‹ μ‘μ„±ν•΄λ³΄μ.

λ¨Όμ € `CardNumberValidator`λ¥Ό λ€μ‹ ν•  λ€μ—­ ν΄λμ¤λ¥Ό μ‘μ„±ν•μ.

`StubCardNumberValidator`λ¥Ό μ΄μ©ν•΄μ„ `AutoDebitRegister` λ¥Ό ν…μ¤νΈν•λ” μ½”λ“λ¥Ό μ‘μ„±ν•μ.

μ¶”κ°€λ΅ λ„λ‚ μΉ΄λ“μ— λ€ν• ν…μ¤νΈλ¥Ό μ§„ν–‰ν•κ³  μ‹¶λ‹¤.

DB μ—°λ™ μ½”λ“λ„ λ€μ—­μ„ μ‚¬μ©ν•κΈ°μ— μ ν•©ν•λ‹¤. μλ¥Ό λ“¤μ–΄ μλ™μ΄μ²΄ μ •λ³΄μ DB μ—°λ™μ„ μ²λ¦¬ν•λ” λ¦¬ν¬μ§€ν† λ¦¬ μΈν„°νμ΄μ¤κ°€ λ‹¤μκ³Ό κ°™λ‹¤.

`AutoDebitRegister`λ” `AutoDebitInfoRepository`λ¥Ό μ‚¬μ©ν•΄ μλ™μ΄μ²΄ μ •λ³΄λ¥Ό μ €μ¥ν–λ‹¤.

λ€μ—­μ„ μ‚¬μ©ν•λ©΄ DB μ—†μ΄ `AutoDebitRegister`λ¥Ό ν…μ¤νΈν•  μ μλ‹¤. `AutoDebitInfoRepository`μ λ€μ—­ κµ¬ν„μ„ λ‹¤μκ³Ό κ°™μ΄ κµ¬ν„ν•μ.

`MemoryAutoDebitInfoRepository`λ¥Ό μ΄μ©ν•΄ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•μ.