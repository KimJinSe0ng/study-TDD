# 테스트 작성 순서 연습

- 서비스를 사용하려면 매달 1만 원을 선불로 납부한다. 납부일 기준으로 한 달 뒤가 서비스 만료일이 된다.
- 2개월 이상 요금을 납부할 수 있다.
- 10만원을 납부하면 서비스를 1년 제공한다.

납부한 금액 기준으로 서비스 만료일을 계산하는 기능을 TDD로 구현한다면 어떤 순서로 진행해야 할까?  
- [X] 테스트 클래스 이름 정하기

### 쉬운 것부터 테스트
- 구현하기 쉬운 것부터 먼저 테스트
- 예외 상황을 먼저 테스트

만료일 계산기에서 1만원을 납부하면 한 달 뒤 같은 날을 만료일로 계산하는 것이 가장 쉬울 것 같다.
예를 들어, 2019년 3월 1일에 1만원 납부시, 만료일은 2019년 4월 1일이 된다.
계산에 필요한 값은 납부일과 납부액이고 결과는 계산된 만료일이다.

### 예를 추가하면서 구현을 일반화
동일 조건의 예를 추가하면서 구현을 일반화해본다.
먼저 1만원을 납부하는 예를 하나 더 추가하며, 이 예는 2019-03-01 대신 2019-05-05를 납부일로 사용한다.
따라서 만료일은 2019-06-05이어야 한다.

### 코드 정리: 중복 제거
calculateExpiryDate() 메서드는 파라미터가 두 개이다.
파라미터가 더 많으면 객체로 바꿔서 파라미터를 한 개로 만들겠지만 발생하지도 않은 코드를 수정할 필요는 없다.
테스트 메서드에는 다음 형태의 중복이 존재한다.

        LocalDate billingDate = 납부일;
        int payAmount = 납부액;

        ExpiryDateCalculator cal = new ExpiryDateCalculator();
        LocalDate expiryDate = cal.calculateExpiryDate(billingDate, payAmount);

        assertEquals(기댓값, expiryDate);

보통은 중복을 제거하는 것이 좋지만, 테스트 코드 중복 제거에는 고민이 필요하다.
각 테스트 메서드는 스스로 무엇을 테스트하는지 명확하게 설명할 수 있어야 하기 때문인데,
중복을 기계적으로 제거하면 자칫 테스트 메서드가 검증하고 싶은 내용을 알아보기 힘들 수 있다.

### 예외 상황 처리

단순히 한 달 추가로 끝나지 않는 상황이 존재한다.

- 납부일이 2019-01-31이고 납부액이 1만원이면 만료일은 2019-02-28이다.
- 납부일이 2019-05-31이고 납부액이 1만원이면 만료일은 2019-06-30이다.
- 납부일이 2020-01-31이고 납부액이 1만원이면 만료일은 2020-02-29이다.

이 세 가지 조건은 납부일 기준으로 다음 달의 같은 날이 만료일이 아니다. 이를 테스트로 추가하자.

먼저 납부일이 2019-01-31이고 납부액이 1만원이면 만료일은 2019-02-28인 테스트를 추가하자.

### 다음 테스트 선택: 다시 예외 상황

1만원을 납부할 때 한달 뒤가 만료일이 되는 테스트를 진행했으니 그 다음으로 쉽거나 예외적인 것을 선택하면 된다.

- 2만원을 지불하면 만료일이 두 달 뒤가 된다.
- 3만원을 지불하면 만료일이 세 달 뒤가 된다.

다음은 생각할 수 있는 예외 상황이다.

- 첫 납부일이 2019-01-31이고 만료되는 2019-02-28에 1만원을 납부하면 다음 만료일은 2019-03-31이다.
- 첫 납부일이 2019-01-30이고 만료되는 2019-02-28에 1만원을 납부하면 다음 만료일은 2019-03-30이다.
- 첫 납부일이 2019-05-31이고 만료되는 2019-06-30에 1만원을 납부하면 다음 만료일은 2019-07-31이다.

쉬운 것을 먼저 테스트할까? 예외 상황을 먼저 테스트할까?

쉬운 것은 2개월 이상 요금을 지불한 예이고, 예외 상황은 1개월 요금을 지불할 때 발생할 수 있는 예외 상황이다.

이전 테스트가 1개월 요금 지불을 기준으로 하므로 1개월 요금 지불에 대한 예외 상황을 마무리하고 2개월 이상 요금 지불을 테스트하는 것이 좋을 것 같다.

예외 상황을 테스트하려면 첫 납부일이 필요하다. 앞서 작성한 테스트는 납부일과 납부액만 사용했기 때문에 기존 코드에 첫 납부일을 추가하는 작업이 필요하다.

### 다음 테스트를 추가하기 전에 리팩터링

만료일을 계산하는데 필요한 값이 세 개로 늘었다. 다음을 고민할 때가 됐다.

- calculateExpiryDate 메서드의 파라미터로 첫 납부일 추가
- 첫 납부일, 납부일, 납부액을 담은 객체를 calculateExpiryDate 메서드에 전달

첫 납부일을 파라미터로 추가하면 파라미터가 세 개로 늘어난다. **메서드의 파라미터 개수가 세 개 이상이면 객체로 바꿔 한 개로 줄이는 것을 고려해야 한다.**

객체로 바꿔보자.

### 예외 상황 테스트 진행 계속

다음 사례를 테스트로 추가하자.

- 첫 납부일이 2019-01-31이고 만료되는 2019-02-28에 1만원을 납부하면 다음 만료일은 2019-03-31이다.

상수를 통해 위의 테스트를 통과시키고 아래의 테스트 케이스를 추가하자.

- 첫 납부일이 2019-031-30이고 만료되는 2019-02-28에 1만원을 납부하면 다음 만료일은 2019-03-30이다.

테스트를 통과할 만큼만 구현을 일반화 해보자.

- 첫 납부일과 납부일의 일자가 다르면 첫 납부일의 일자를 만료일의 일자로 사용

### 다음 테스트 선택: 쉬운 테스트

이번에 추가할 사례는 다음이다.

- 2만원을 지불하면 만료일이 두 달 뒤가 된다.
- 3만원을 지불하면 만료일이 석 달 뒤가 된다.